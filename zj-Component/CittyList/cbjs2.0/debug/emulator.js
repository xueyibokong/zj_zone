define(["cbui_core","cbui_request"],function(a,b){var c,d,e,f,g;return d=a.Fn._,e=b.prototype.fetch,g=a.Fn.getLocalStorage(),f=function(a){return a.replace(/\/$/,"")},c=f(g.getItem("DEBUG_SERVER")||""),b.prototype.fetch=function(){var a,b,f;return console.log("%cproxy: [%s] %s %o","color:#ff00ff",this.request.requestId,this.request.url,this.request),f=this.request.url,d.startsWith(f,"client:///")?e.call(this):(b=this,a=this.request.data,f=c+"/emulator/proxy/"+f,f+=f.indexOf("?")?"&":"?",f+="data="+JSON.stringify(a),$.ajax({dataType:"jsonp",url:f,timeout:15e3,success:function(a){b.complete({result:0,data:a})}}))},a.Emulator={init:function(a,b){return null==a&&(a={}),null==b&&(b=this.alertCallback),a.debugServer&&(c=f(a.debugServer),g.setItem("DEBUG_SERVER",c)),$.ajax({dataType:"jsonp",url:c+"/emulator/init?data="+JSON.stringify({server:a.targetServer,handshakeData:a.handshakeData||{}}),timeout:15e3,success:function(a){b("success",a)}})},exit:function(a){return null==a&&(a=this.alertCallback),$.ajax({dataType:"jsonp",url:c+"/emulator/exit",timeout:15e3,success:function(b){a("success",b)}})},getPassword:function(a,b){$.ajax({dataType:"jsonp",url:c+"/emulator/getPassword?data="+JSON.stringify({text:a}),timeout:15e3,success:function(a){b(a.value)}})},alertCallback:function(a,b){alert(JSON.stringify(b,null,"  "))}}});