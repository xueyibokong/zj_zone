console.log("def:component_scrollview"),define(["cbui_core","lib/iscroll"],function(a){var b="fw-loading",c=a.Component,d=a.Template,e=a.Fn,f=iScroll,g=e.$;c.ScrollView=c.Container.extend({initialize:function(a){this._super(a),this.height=this.$el.data("height"),this.fixHeight=this.$el.data("fix-height"),this.refreshTemplate=_.template("松开手指开始载入",d.outerSettings),this.loadingTemplate=_.template("加载中...",d.outerSettings),this.minDrag=e.getTypeVal("Finite",20,a.minDrag),e.bindFunctions(this,"onRefresh","onScrollMove","onScrollEnd");var b=new RegExp("(^|\\s)iScrollHover(\\s|$)"),c=function(){this.hoverTarget&&(clearTimeout(this.hoverTimeout),this.hoverTarget.className=this.hoverTarget.className.replace(b,""),this.target=null)},h=this,i={hScrollbar:!1,vScrollbar:!1,onRefresh:this.onRefresh,onScrollMove:this.onScrollMove,onScrollEnd:this.onScrollEnd,onBeforeScrollStart:function(a){a.touches&&(h.lastY=a.touches[0].pageY);var c=a.target;for(clearTimeout(this.hoverTimeout);c&&"tr"!==c.localName;)c=c.parentNode;c&&(this.hoverTimeout=setTimeout(function(){b.test(c.className)||(c.className=c.className?c.className+" iScrollHover":"iScrollHover")},100),this.hoverTarget=c),a.preventDefault()},onBeforeScrollMove:c,onBeforeScrollEnd:c,checkDOMChanges:!0};this.page=g(".fw-page-current");var j;_.isFinite(this.height)?j=this.height:(j=this.page[0].offsetHeight-this.$el[0].offsetTop,0>=j&&(j=0),_.isFinite(this.fixHeight)&&(j+=this.$el[0].offsetTop-this.fixHeight)),this.$el.css({height:j}),this.iScroll=new f(this.el,i)},onRefresh:function(){this.refreshingData=!1;var a,c,d,f,h={},i={},j=this.$("[data-refresh-button]");j.removeClass(b);for(var k=0,l=j.length;l>k;k++)for(a=j[k].getAttribute("data-refresh-button")||"drag",c=j[k].parentNode;c!==this.$el[0];){if(_.isString(c.getAttribute("data-component"))&&_.isString(c.id)&&(d=e.getComponent(c.id),_.isObject(d)&&(f=d.onDragRefresh,_.isFunction(f)))){void 0===h[a]&&(h[a]=[]),h[a].push(j[k]),i[a]=f;break}c=c.parentNode}_.keys(h).forEach(function(a){h[a]=g(h[a]),h[a].attr("data-more-text",h[a].html())}),this.refreshBtns=h,this.refreshFuns=i},onScrollMove:function(a){if(a.touches&&((this.lastY-a.touches[0].pageY>0||this.iScroll.y>0)&&(this.page[0].scrollTop+=this.lastY-a.touches[0].pageY),this.lastY=a.touches[0].pageY),!this.refreshingData){var c,d,e=this.iScroll,f=this.refreshBtns,g=this.minDrag,h=e.maxScrollY>0?0:e.maxScrollY;e.y<h?(d="up",c=f[d],void 0===c&&(d="drag",c=f[d]),void 0!==c&&(e.y>h-g?(c.removeClass(b),c.html(c.data("more-text"))):(c.addClass(b),c.html(this.refreshTemplate({direction:d}))))):e.y>0&&(d="down",c=f[d],void 0===c&&(d="drag",c=f[d]),void 0!==c&&(e.y<g?(c.removeClass(b),c.html(c.data("more-text"))):(c.addClass(b),c.html(this.refreshTemplate({direction:d})))))}},onScrollEnd:function(){if(!this.refreshingData){var a=this,c=this.refreshBtns,d=this.refreshFuns;_.keys(c).forEach(function(e){var f=c[e],g;f.hasClass(b)&&(f.html(a.loadingTemplate({direction:e})),g=d[e],_.isFunction(g)&&(a.refreshingData=!0,g(e)))})}}})});