console.log("def:component_softkeyboard"),define(["cbui_const","cbui_core","fastclick"],function(a,b,c){var d=b.Component,e=b.Browser,f=b.Fn,g=b.Template,h=f.$,i=function(a,b,c){b=b||{},_.defaults(b,{"font-size":"22px",background:"#FFFFFF",height:"48px",width:"8%",margin:"1%",padding:"0"});var d=h('<input class="btn btn-default" type="button" data-keyboard-key="'+f.getTypeVal("String",c,a)+'"/>');return d.css(b),d.val(a),d};g.Keyboard=_.defaults({},g.Keyboard,{FullAlphabet:{page:0,keyList:["qwertyuiopasdfghjklzxcvbnm","QWERTYUIOPASDFGHJKLZXCVBNM"],content:function(){var a=h('<div style="width: 100%"></div>'),b,c;for(c=h("<div></div>"),b=0;10>b;b++)c.append(i(this.keyList[this.page].substr(b,1)));for(a.append(c),c=h("<div></div>"),b=10;19>b;b++)10==b?c.append(i(this.keyList[this.page].substr(b,1),{margin:"1% 1% 1% 6%"})):18==b?c.append(i(this.keyList[this.page].substr(b,1),{margin:"1% 6% 1% 1%"})):c.append(i(this.keyList[this.page].substr(b,1)));for(a.append(c),c=h("<div></div>"),c.append(i("^",{width:"13%"},"shift")),b=19;26>b;b++)c.append(i(this.keyList[this.page].substr(b,1)));return c.append(i("<",{width:"13%"},"backspace")),a.append(c),c=h("<div></div>"),c.append(c.append(i("#+123",{width:"28%"},"switch:FullSymbol"))),c.append(c.append(i("空格",{width:"38%"}," "))),c.append(c.append(i("完成",{width:"28%"},"done"))),a.append(c),a}},FullSymbol:{page:0,keyList:['1234567890-/:;()$&@".,?!`',"[]{}#%^*+=_\\|~<>€£¥·.,?!'"],content:function(){var a=h('<div style="width: 100%"></div>'),b,c;for(c=h("<div></div>"),b=0;10>b;b++)c.append(i(this.keyList[this.page].substr(b,1)));for(a.append(c),c=h("<div></div>"),b=10;20>b;b++)c.append(i(this.keyList[this.page].substr(b,1)));for(a.append(c),c=h("<div></div>"),c.append(i("#+=",{width:"18%"},"shift")),b=20;25>b;b++)c.append(i(this.keyList[this.page].substr(b,1),{width:"10%"}));return c.append(i("<",{width:"18%"},"backspace")),a.append(c),c=h("<div></div>"),c.append(c.append(i("ABC",{width:"28%"},"switch:FullAlphabet"))),c.append(c.append(i("空格",{width:"38%"}," "))),c.append(c.append(i("完成",{width:"28%"},"done"))),a.append(c),a}},SmallNumber:{page:0,keyList:["0123456789"],content:function(){var a=h('<div style="width: 100%"></div>'),b,c;for(c=h("<div></div>"),b=1;4>b;b++)c.append(i(this.keyList[this.page].substr(b,1),{width:"31.33%"}));for(a.append(c),c=h("<div></div>"),b=4;7>b;b++)c.append(i(this.keyList[this.page].substr(b,1),{width:"31.33%"}));for(a.append(c),c=h("<div></div>"),b=7;10>b;b++)c.append(i(this.keyList[this.page].substr(b,1),{width:"31.33%"}));return a.append(c),c=h("<div></div>"),c.append(c.append(i("完成",{width:"31.33%"},"done"))),c.append(c.append(i("0",{width:"31.33%"},"0"))),c.append(c.append(i("<",{width:"31.33%"},"backspace"))),a.append(c),a}}}),d.SoftKeyboard=d.Form.extend({initialize:function(a){a=a||{},this._super(a),this.$el=h('<div data-softkeyboard style="overflow: auto;position: absolute;bottom: 0;z-index: 9999;width:100%;background: #3270B4;display: none"></div>'),h("body").append(this.$el),c.attach(this.$el[0]),f.bindFunctions(this,"hide","onKeyDown","onKeyPress"),this.bindEvent("click [data-keyboard-key]",function(a){this.onInput(h(a.currentTarget))})},onKeyDown:function(a){var b;if(8===a.keyCode)b="backspace";else if(13===a.keyCode)b="done";else if(32===a.keyCode)b=" ";else if(38===a.keyCode)b="shift";else{if(37!==a.keyCode&&39!==a.keyCode)return 40===a.keyCode?(a.preventDefault(),void 0):void 0;var c=this.$('[data-keyboard-key^="switch:"]');b=c.data("keyboard-key")}a.preventDefault(),this.onInput(b)},onKeyPress:function(a){this.onInput(String.fromCharCode(a.keyCode))},onInput:function(a){var b;if(_.isObject(a)?(b=a,a=b.data("keyboard-key")):b=this.$('[data-keyboard-key="'+a+'"]'),b.length>0)if(this.subKeyboard.keyList&&(b.css({background:"#f00"}),setTimeout(function(){b.css({background:"#FFFFFF"})},200)),"backspace"===a)(this.text.length>0&&this.conf.checkInput?this.conf.checkInput(this.text.substring(0,this.text.length-1)):!0)&&(this.text=this.text.substring(0,this.text.length-1),this.doInput());else if("done"===a)this.hide();else if("shift"===a){var c=this.subKeyboard;c.page=(c.page+1)%c.keyList.length,this.$el.html(""),this.$el.append(f.safeCall.call(this.subKeyboard,g.obtainTemplate(this.subKeyboard.content)))}else if(_.startsWith(a,"switch:")){if(this.$el.html(""),this.subKeyboard=g.Keyboard[a.split(":")[1]],!this.subKeyboard){var d=this.getKeyboardTemplate(a.split(":")[1]);if(!d)return console.log("can't find keyboard template"),void 0;this.subKeyboard=d}this.$el.append(f.safeCall.call(this.subKeyboard,g.obtainTemplate(this.subKeyboard.content)))}else(this.text.length<this.conf.maxLength&&this.conf.checkInput?this.conf.checkInput(this.text+a):!0)&&(this.text+=a,this.doInput())},doInput:function(){if(b.Emulator&&""!==this.conf.encryptor){var a=this;b.Emulator.getPassword(this.text,function(b){a.value=b,a.conf.onInput({text:a.text,value:a.value,strength:5})})}else this.value=this.text,this.conf.onInput({text:this.text,value:this.value,strength:5})},getKeyboardTemplate:function(a){return g.obtainTemplate("#"+f.addTpPrefix((a||"").toString().substring(1)))?{content:"#"+f.addTpPrefix((a||"").toString().substring(1))}:g.Keyboard?g.Keyboard[a]:void 0},show:function(b){var c=b.dependencyManager,d=b.self,i=d.model,j=d.$el,k=j.is("input")||j.is("textarea"),l=j.data("keyboard-type"),m=j.data("keyboard-mode"),n=h(".fw-i-img");if(n.remove(),this.isShow&&this.lastElement!==d&&this.lastElement.$el.data("keyboard-mode")){this.conf.onSubmit(),this.$el.hide();var o=h(".fw-page-current");o.css("height",this.pageHeight),h(".fw-browser-footer").css("bottom",0),h(document).off("keydown",this.onKeyDown),h(document).off("keypress",this.onKeyPress),e.unbindGoBack(this.hide)}if(!m)return this.lastElement=d,void 0;var p=d.getValue();if("softkeyboard"==m&&p){var n=h(".fw-i-img");if(n.remove(),!k){var q=h('<img class="fw-i-img" src="data:image;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOwis">');j.append(q),q.show()}this.text=this.value=p}else{if(d.reset(),k)j.attr({readonly:!0});else{var r=h("<span id=span"+(_.startsWith(d.id,"#")?d.id.substring(1):d.id)+"></span>"),q=h('<img class="fw-i-img" src="data:image;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOwis">');j.css({"word-wrap":"break-word","overflow-y":"hidden"}),j.append(r),j.append(q),q.show()}this.text="",this.value=""}if(!this.isShow||this.lastElement!==d||"bridge"===m){this.lastElement=d;var s;switch(s={mask:j.data("mask"),random:j.data("random")||!1,encryptor:j.data("encryptor"),keyboardType:l,maxLength:j.data("v-max-len")||64,$el:j,checkInput:function(a){return d.checkInput(null,i.getValue(),a)},onInput:function(a){i.setValue(a.value,{validate:!0,silent:!0});var b=j.data("mask")?a.text.replace(/./g,"*"):a.text;k?j.val(b):(h("#span"+(_.startsWith(d.id,"#")?d.id.substring(1):d.id)).html(b),b?d.$placeholder.hide():d.$placeholder.show()),f.safeCall.call(d,d.onInputChange,a),c.calcDependency(j.id)},onDelete:function(a){i.setValue(a.value,{validate:!0,silent:!0}),k?j.val(a.text):(h("#span"+(_.startsWith(d.id,"#")?d.id.substring(1):d.id)).html(a.text),a.text?d.$placeholder.hide():d.$placeholder.show()),f.safeCall.call(d,d.onInputChange,a),c.calcDependency(j.id)},onSubmit:function(){var a=h(".fw-i-img");a.remove(),j.blur()},onKeyboardPopup:function(){}},m){case"bridge":if(a.APPCLIENT)return f.trigger("bridge:showKeyboard",s),void 0;case"softkeyboard":}switch(this.conf=s,this.$el.html(""),l){case 1:this.subKeyboard=g.Keyboard.FullAlphabet;break;case 2:this.subKeyboard=g.Keyboard.SmallNumber;break;default:var t=this.getKeyboardTemplate(l);t?this.subKeyboard=t:this.subKeyboard=g.Keyboard.FullAlphabet}this.$el.append(f.safeCall.call(this.subKeyboard,g.obtainTemplate(this.subKeyboard.content))),this.$el.show(),e.bindGoBack(this.hide),h(document).on("keydown",this.onKeyDown),h(document).on("keypress",this.onKeyPress);var o=h(".fw-page-current");this.pageHeight=o.height(),o.css("height",o.height()-this.$el.height());var u=h(".fw-browser-footer");u.css("bottom",this.$el.height()),f.scrollToVisualArea(j,o)}this.isShow=!0},hide:function(){if(this.isShow){this.conf.onSubmit(),this.$el.hide();var a=h(".fw-page-current");a.css("height",this.pageHeight),h(".fw-browser-footer").css("bottom",0),h(document).off("keydown",this.onKeyDown),h(document).off("keypress",this.onKeyPress),e.unbindGoBack(this.hide)}this.isShow=!1}})});